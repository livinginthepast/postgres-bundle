#!/usr/bin/env bash

set -e

source "bin/_support/cecho.sh"
source "bin/_support/step.sh"

POSTGRES_VERSION="$(postgres -V | cut -d' ' -f3)"

step "make temp directory" \
  "mkdir -p tmp"

step "download postgis tar file" \
  "wget http://download.osgeo.org/postgis/source/postgis-3.0.1.tar.gz -O tmp/postgis-3.0.1.tar.gz"

step "untar postgis" \
  "(cd tmp && tar xzf postgis-3.0.1.tar.gz)"

step "configure postgis" \
  "(cd tmp/postgis-3.0.1 && ./configure --prefix=\"/Users/sax/.asdf/installs/postgres/${POSTGRES_VERSION}\")"

step "make" \
  "(cd tmp/postgis-3.0.1 && make)"

step "make install" \
  "(cd tmp/postgis-3.0.1 && make install)"

